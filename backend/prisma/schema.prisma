// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  role          UserRole @default(ADMIN)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  lastLoginAt   DateTime?

  @@map("users")
}

enum UserRole {
  ADMIN
  EDITOR  // For future use
}

// Content Management
model Content {
  id        String   @id @default(cuid())
  key       String   @unique // e.g., "hero.title", "services.description"
  type      ContentType
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  translations ContentTranslation[]

  @@map("content")
}

enum ContentType {
  TEXT
  RICH_TEXT
  HTML
  JSON
}

model ContentTranslation {
  id        String   @id @default(cuid())
  contentId String
  locale    Locale
  value     String   @db.Text
  
  content   Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)
  
  @@unique([contentId, locale])
  @@map("content_translations")
}

// Testimonials
model Testimonial {
  id        String   @id @default(cuid())
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  translations TestimonialTranslation[]

  @@index([isActive, order])
  @@map("testimonials")
}

model TestimonialTranslation {
  id            String   @id @default(cuid())
  testimonialId String
  locale        Locale
  name          String
  role          String?
  company       String?
  content       String   @db.Text
  
  testimonial   Testimonial @relation(fields: [testimonialId], references: [id], onDelete: Cascade)
  
  @@unique([testimonialId, locale])
  @@map("testimonial_translations")
}

// Leads (Contact Form Submissions)
model Lead {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  message   String   @db.Text
  status    LeadStatus @default(NEW)
  source    String   @default("contact_form")
  metadata  Json?    // Additional data (IP, user agent, etc.)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([status])
  @@index([createdAt])
  @@index([email])
  @@map("leads")
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CLOSED
}

// Meeting Bookings
model Meeting {
  id            String        @id @default(cuid())
  email         String
  name          String
  phone         String?
  scheduledAt   DateTime
  duration      Int           @default(30) // minutes
  timezone      String        @default("UTC")
  status        MeetingStatus @default(CONFIRMED)
  notes         String?       @db.Text
  confirmationToken String    @unique
  cancelledAt   DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  @@index([scheduledAt])
  @@index([status])
  @@index([email])
  @@map("meetings")
}

enum MeetingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// Meeting Availability Configuration
model MeetingAvailability {
  id          String   @id @default(cuid())
  dayOfWeek   Int      // 0 = Sunday, 6 = Saturday
  startTime   String   // HH:mm format
  endTime     String   // HH:mm format
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([dayOfWeek, startTime, endTime])
  @@map("meeting_availability")
}

// Social Media Links
model SocialLink {
  id        String   @id @default(cuid())
  platform  String   // e.g., "facebook", "linkedin", "twitter"
  url       String   @db.Text
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("social_links")
}

// External Links
model ExternalLink {
  id        String   @id @default(cuid())
  label     String
  url       String   @db.Text
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("external_links")
}

// Legal Pages Content
model LegalPage {
  id        String   @id @default(cuid())
  slug      String   @unique // e.g., "gdpr", "privacy", "terms"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  translations LegalPageTranslation[]

  @@map("legal_pages")
}

model LegalPageTranslation {
  id          String   @id @default(cuid())
  legalPageId String
  locale      Locale
  title       String
  content     String   @db.Text
  
  legalPage   LegalPage @relation(fields: [legalPageId], references: [id], onDelete: Cascade)
  
  @@unique([legalPageId, locale])
  @@map("legal_page_translations")
}

enum Locale {
  EN
  SK
  DE
  CZ
}

// Cookie Consent Tracking (GDPR Compliance)
model CookieConsent {
  id        String   @id @default(cuid())
  userId    String?  // null for anonymous users
  email     String?  // For tracking consent by email (if provided)
  consent   Boolean  // true = accepted, false = rejected
  timestamp DateTime @default(now())
  ipAddress String?
  userAgent String?
  
  @@index([userId])
  @@index([email])
  @@index([timestamp])
  @@map("cookie_consents")
}

